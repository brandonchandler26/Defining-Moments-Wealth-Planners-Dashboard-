<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Profile Hub | Defining Moments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="constants.js"></script>
    <script src="state-manager.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #F9F9F7;
        }

        .brand-navy {
            color: #00205B;
        }

        .bg-brand-navy {
            background-color: #00205B;
        }

        .bg-brand-gold {
            background-color: #D4AF37;
        }

        .border-brand-gold {
            border-color: #D4AF37;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            outline: none;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: #00205B;
            box-shadow: 0 0 0 2px rgba(0, 32, 91, 0.1);
        }

        .section-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #E2E8F0;
            overflow: hidden;
        }

        .section-header {
            background: #00205B;
            color: white;
            padding: 0.875rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .section-body {
            padding: 1.25rem;
        }

        .label-style {
            display: block;
            font-size: 0.7rem;
            font-weight: 700;
            color: #00205B;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
            letter-spacing: 0.025em;
        }

        .list-item {
            background: #F9F9F7;
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            padding: 0.875rem;
            margin-bottom: 0.625rem;
        }

        .list-item:last-child {
            margin-bottom: 0;
        }

        .btn-add {
            background: #D4AF37;
            color: #00205B;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-add:hover {
            background: #B5952F;
        }

        .btn-delete {
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .btn-delete:hover {
            background: #fef2f2;
        }

        .summary-box {
            background: linear-gradient(135deg, #00205B, #003380);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
        }

        .summary-value {
            font-weight: 700;
            font-size: 1rem;
        }

        .summary-value.gold {
            color: #D4AF37;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: white;
            border: 2px solid #D4AF37;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header
            class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 border-b-4 border-brand-gold pb-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold brand-navy">Client Profile Hub</h1>
                <p class="text-gray-500 text-sm font-medium">The central data engine for all planning tools</p>
            </div>
            <div class="flex gap-2 flex-wrap">
                <button onclick="exportToJSON()"
                    class="bg-brand-navy text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-opacity-90 transition-all flex items-center gap-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Export
                </button>
                <input type="file" id="fileInput" class="hidden" onchange="importFromJSON(event)">
                <button onclick="document.getElementById('fileInput').click()"
                    class="border-2 border-brand-navy text-brand-navy px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-100 transition-all">Load</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Personal Info -->
            <div class="space-y-6">
                <section class="section-card">
                    <div class="section-header">
                        <h2>Personal Identity</h2>
                    </div>
                    <div class="section-body space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-style">Client 1 First Name</label><input type="text"
                                    id="client1Name" class="input-field" placeholder="John"></div>
                            <div><label class="label-style">Client 1 Last Name</label><input type="text"
                                    id="client1LastName" class="input-field" placeholder="Smith"></div>
                            <div><label class="label-style">Client 2 First Name</label><input type="text"
                                    id="client2Name" class="input-field" placeholder="Jane"></div>
                            <div><label class="label-style">Client 2 Last Name</label><input type="text"
                                    id="client2LastName" class="input-field" placeholder="Smith"></div>
                            <div><label class="label-style">Client 1 DOB</label><input type="date" id="client1DOB"
                                    class="input-field"></div>
                            <div><label class="label-style">Client 2 DOB</label><input type="date" id="client2DOB"
                                    class="input-field"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="label-style">Filing Status</label>
                                <select id="filingStatus" class="input-field">
                                    <option value="single">Single</option>
                                    <option value="mfj" selected>Married Filing Jointly</option>
                                    <option value="mfs">Married Filing Separately</option>
                                    <option value="hoh">Head of Household</option>
                                </select>
                            </div>
                            <div><label class="label-style">State</label>
                                <select id="residenceState" class="input-field">
                                    <option value="MO" selected>Missouri</option>
                                    <option value="KS">Kansas</option>
                                    <option value="CA">California</option>
                                    <option value="TX">Texas</option>
                                    <option value="FL">Florida</option>
                                    <option value="NY">New York</option>
                                    <option value="IL">Illinois</option>
                                    <option value="CO">Colorado</option>
                                    <option value="AZ">Arizona</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Summary Box -->
                <div class="summary-box">
                    <h3 class="text-lg font-bold mb-4 text-white">Financial Summary</h3>
                    <div class="summary-row"><span class="summary-label">Total Income</span><span
                            class="summary-value gold" id="totalIncomeDisplay">$0</span></div>
                    <div class="summary-row"><span class="summary-label">Total Assets</span><span class="summary-value"
                            id="totalAssetsDisplay">$0</span></div>
                    <div class="summary-row"><span class="summary-label">Total Liabilities</span><span
                            class="summary-value" id="totalLiabilitiesDisplay">$0</span></div>
                    <div class="summary-row"
                        style="border-top: 2px solid #D4AF37; margin-top: 0.5rem; padding-top: 0.75rem;">
                        <span class="summary-label font-bold">Net Worth</span><span class="summary-value gold text-xl"
                            id="netWorthDisplay">$0</span>
                    </div>
                </div>

                <button onclick="saveAll()"
                    class="w-full bg-brand-gold text-brand-navy py-3 rounded-lg font-bold hover:bg-[#B5952F] transition-all flex items-center justify-center gap-2 text-lg">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Save & Sync All
                </button>
            </div>

            <!-- Middle Column: Income Sources -->
            <div class="space-y-6">
                <section class="section-card">
                    <div class="section-header">
                        <h2>Income Sources</h2>
                    </div>
                    <div class="section-body" id="incomeContainer">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <svg class="h-8 w-8 text-blue-500 mx-auto mb-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="text-blue-800 font-medium mb-1">You will enter your income on the Cash Flow
                                Calculator tab</p>
                            <p class="text-blue-600 text-sm">Income data entered there will flow into the Tax Calculator
                                and Retirement Projector automatically.</p>
                        </div>
                    </div>
                </section>

                <section class="section-card">
                    <div class="section-header">
                        <h2>Liabilities</h2>
                        <button class="btn-add" onclick="addLiability()">+ Add</button>
                    </div>
                    <div class="section-body" id="liabilitiesContainer">
                        <p class="text-gray-400 text-sm text-center py-4">Click "+ Add" to add liabilities</p>
                    </div>
                </section>
            </div>

            <!-- Right Column: Assets -->
            <div class="space-y-6">
                <section class="section-card">
                    <div class="section-header">
                        <h2>Asset Accounts</h2>
                        <button class="btn-add" onclick="addAsset()">+ Add</button>
                    </div>
                    <div class="section-body" id="assetsContainer">
                        <p class="text-gray-400 text-sm text-center py-4">Click "+ Add" to add assets</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"><span id="toastMsg">Saved!</span></div>

    <script>
        // Format currency
        const fmt = (n) => '$' + (n || 0).toLocaleString('en-US', { maximumFractionDigits: 0 });

        // Build income type options
        function getIncomeTypeOptions() {
            return Object.entries(GlobalStateManager.INCOME_TYPES)
                .map(([key, val]) => `<option value="${key}">${val.name}</option>`)
                .join('');
        }

        // Build asset type options (grouped)
        function getAssetTypeOptions() {
            const types = GlobalStateManager.ASSET_TYPES;
            const groups = { retirement: [], investment: [], cash: [], property: [], other: [] };
            Object.entries(types).forEach(([key, val]) => {
                groups[val.category]?.push({ key, name: val.name });
            });
            return `
                <optgroup label="Retirement">${groups.retirement.map(t => `<option value="${t.key}">${t.name}</option>`).join('')}</optgroup>
                <optgroup label="Investment">${groups.investment.map(t => `<option value="${t.key}">${t.name}</option>`).join('')}</optgroup>
                <optgroup label="Cash & Savings">${groups.cash.map(t => `<option value="${t.key}">${t.name}</option>`).join('')}</optgroup>
                <optgroup label="Real Estate">${groups.property.map(t => `<option value="${t.key}">${t.name}</option>`).join('')}</optgroup>
                <optgroup label="Other">${groups.other.map(t => `<option value="${t.key}">${t.name}</option>`).join('')}</optgroup>
            `;
        }

        // Build liability type options
        function getLiabilityTypeOptions() {
            return Object.entries(GlobalStateManager.LIABILITY_TYPES)
                .map(([key, val]) => `<option value="${key}">${val.name}</option>`)
                .join('');
        }

        // Get client names for owner dropdowns (personalized labels)
        function getClientNames() {
            const name1 = document.getElementById('client1Name')?.value || '';
            const name2 = document.getElementById('client2Name')?.value || '';
            return {
                client1: name1 || 'Client 1',
                client2: name2 || 'Client 2',
                joint: (name1 && name2) ? `${name1} & ${name2}` : 'Joint'
            };
        }

        // Build owner options with real client names
        function getOwnerOptions(selected) {
            const names = getClientNames();
            return `
                <option value="client1" ${selected === 'client1' ? 'selected' : ''}>${names.client1}</option>
                <option value="client2" ${selected === 'client2' ? 'selected' : ''}>${names.client2}</option>
                <option value="joint" ${selected === 'joint' ? 'selected' : ''}>${names.joint}</option>
            `;
        }

        // Render income sources
        function renderIncomeSources() {
            const state = GlobalStateManager.getState();
            const sources = state.incomeSources || [];
            const container = document.getElementById('incomeContainer');

            if (sources.length === 0) {
                container.innerHTML = '<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center"><svg class="h-8 w-8 text-blue-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><p class="text-blue-800 font-medium mb-1">You will enter your income on the Cash Flow Calculator tab</p><p class="text-blue-600 text-sm">Income data entered there will flow into the Tax Calculator and Retirement Projector automatically.</p></div>';
                return;
            }

            container.innerHTML = sources.map((src, i) => `
                <div class="list-item" data-id="${src.id}">
                    <div class="flex justify-between items-start mb-2">
                        <select class="input-field text-xs" style="width: auto;" onchange="updateIncome(${i}, 'type', this.value)">${getIncomeTypeOptions().replace(`value="${src.type}"`, `value="${src.type}" selected`)}</select>
                        <button class="btn-delete" onclick="deleteIncome(${i})"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label-style">Owner</label>
                            <select class="input-field" onchange="updateIncome(${i}, 'owner', this.value)">
                                ${getOwnerOptions(src.owner)}
                            </select>
                        </div>
                        <div><label class="label-style">Annual Amount</label><input type="number" class="input-field" value="${src.amount || 0}" onchange="updateIncome(${i}, 'amount', this.value)"></div>
                    </div>
                </div>
            `).join('');
        }

        // Render assets
        function renderAssets() {
            const state = GlobalStateManager.getState();
            const assets = state.assets || [];
            const container = document.getElementById('assetsContainer');

            if (assets.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Click "+ Add" to add assets</p>';
                return;
            }

            container.innerHTML = assets.map((asset, i) => `
                <div class="list-item" data-id="${asset.id}">
                    <div class="flex justify-between items-start mb-2">
                        <select class="input-field text-xs" style="width: auto; max-width: 180px;" onchange="updateAsset(${i}, 'type', this.value)">${getAssetTypeOptions().replace(`value="${asset.type}"`, `value="${asset.type}" selected`)}</select>
                        <button class="btn-delete" onclick="deleteAsset(${i})"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label-style">Owner</label>
                            <select class="input-field" onchange="updateAsset(${i}, 'owner', this.value)">
                                ${getOwnerOptions(asset.owner)}
                            </select>
                        </div>
                        <div><label class="label-style">Balance</label><input type="number" class="input-field" value="${asset.balance || 0}" onchange="updateAsset(${i}, 'balance', this.value)"></div>
                    </div>
                    <div class="mt-2"><label class="label-style">Description (optional)</label><input type="text" class="input-field" value="${asset.name || ''}" placeholder="e.g., Fidelity 401k" onchange="updateAsset(${i}, 'name', this.value)"></div>
                </div>
            `).join('');
        }

        // Render liabilities
        function renderLiabilities() {
            const state = GlobalStateManager.getState();
            const liabilities = state.liabilities || [];
            const container = document.getElementById('liabilitiesContainer');

            if (liabilities.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Click "+ Add" to add liabilities</p>';
                return;
            }

            container.innerHTML = liabilities.map((liab, i) => `
                <div class="list-item" data-id="${liab.id}">
                    <div class="flex justify-between items-start mb-2">
                        <select class="input-field text-xs" style="width: auto;" onchange="updateLiability(${i}, 'type', this.value)">${getLiabilityTypeOptions().replace(`value="${liab.type}"`, `value="${liab.type}" selected`)}</select>
                        <button class="btn-delete" onclick="deleteLiability(${i})"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div><label class="label-style">Balance</label><input type="number" class="input-field" value="${liab.balance || 0}" onchange="updateLiability(${i}, 'balance', this.value)"></div>
                        <div><label class="label-style">Rate %</label><input type="number" step="0.1" class="input-field" value="${liab.rate || 0}" onchange="updateLiability(${i}, 'rate', this.value)"></div>
                        <div><label class="label-style">Payment</label><input type="number" class="input-field" value="${liab.payment || 0}" onchange="updateLiability(${i}, 'payment', this.value)"></div>
                    </div>
                </div>
            `).join('');
        }

        // Add/Update/Delete functions
        function addIncomeSource() {
            const state = GlobalStateManager.getState();
            const sources = state.incomeSources || [];
            sources.push({ id: GlobalStateManager.generateId(), type: 'w2', owner: 'client1', amount: 0 });
            GlobalStateManager.setState({ incomeSources: sources });
            renderIncomeSources();
            updateSummary();
        }

        function updateIncome(index, field, value) {
            const state = GlobalStateManager.getState();
            const sources = state.incomeSources || [];
            if (sources[index]) {
                sources[index][field] = field === 'amount' ? parseFloat(value) || 0 : value;
                GlobalStateManager.setState({ incomeSources: sources });
                updateSummary();
            }
        }

        function deleteIncome(index) {
            const state = GlobalStateManager.getState();
            const sources = state.incomeSources || [];
            sources.splice(index, 1);
            GlobalStateManager.setState({ incomeSources: sources });
            renderIncomeSources();
            updateSummary();
        }

        function addAsset() {
            const state = GlobalStateManager.getState();
            const assets = state.assets || [];
            assets.push({ id: GlobalStateManager.generateId(), type: '401k', owner: 'client1', balance: 0, name: '' });
            GlobalStateManager.setState({ assets: assets });
            renderAssets();
            updateSummary();
        }

        function updateAsset(index, field, value) {
            const state = GlobalStateManager.getState();
            const assets = state.assets || [];
            if (assets[index]) {
                assets[index][field] = field === 'balance' ? parseFloat(value) || 0 : value;
                GlobalStateManager.setState({ assets: assets });
                updateSummary();
            }
        }

        function deleteAsset(index) {
            const state = GlobalStateManager.getState();
            const assets = state.assets || [];
            assets.splice(index, 1);
            GlobalStateManager.setState({ assets: assets });
            renderAssets();
            updateSummary();
        }

        function addLiability() {
            const state = GlobalStateManager.getState();
            const liabilities = state.liabilities || [];
            liabilities.push({ id: GlobalStateManager.generateId(), type: 'mortgage', balance: 0, rate: 0, payment: 0 });
            GlobalStateManager.setState({ liabilities: liabilities });
            renderLiabilities();
            updateSummary();
        }

        function updateLiability(index, field, value) {
            const state = GlobalStateManager.getState();
            const liabilities = state.liabilities || [];
            if (liabilities[index]) {
                liabilities[index][field] = ['balance', 'rate', 'payment'].includes(field) ? parseFloat(value) || 0 : value;
                GlobalStateManager.setState({ liabilities: liabilities });
                updateSummary();
            }
        }

        function deleteLiability(index) {
            const state = GlobalStateManager.getState();
            const liabilities = state.liabilities || [];
            liabilities.splice(index, 1);
            GlobalStateManager.setState({ liabilities: liabilities });
            renderLiabilities();
            updateSummary();
        }

        // Update summary display
        function updateSummary() {
            document.getElementById('totalIncomeDisplay').textContent = fmt(GlobalStateManager.getTotalIncome());
            document.getElementById('totalAssetsDisplay').textContent = fmt(GlobalStateManager.getPortfolioTotals().total);
            document.getElementById('totalLiabilitiesDisplay').textContent = fmt(GlobalStateManager.getTotalLiabilities());
            document.getElementById('netWorthDisplay').textContent = fmt(GlobalStateManager.getNetWorth());
        }

        // Populate personal info fields
        function populatePersonalInfo() {
            const state = GlobalStateManager.getState();
            document.getElementById('client1Name').value = state.client1?.name || '';
            document.getElementById('client1LastName').value = state.client1?.lastName || '';
            document.getElementById('client2Name').value = state.client2?.name || '';
            document.getElementById('client2LastName').value = state.client2?.lastName || '';
            document.getElementById('client1DOB').value = state.client1?.dob || '';
            document.getElementById('client2DOB').value = state.client2?.dob || '';
            document.getElementById('filingStatus').value = state.filingStatus || 'mfj';
            document.getElementById('residenceState').value = state.state || 'MO';
        }

        // Collect personal info
        function collectPersonalInfo() {
            return {
                client1: {
                    name: document.getElementById('client1Name').value,
                    lastName: document.getElementById('client1LastName').value,
                    dob: document.getElementById('client1DOB').value || null,
                    age: GlobalStateManager.calculateAge(document.getElementById('client1DOB').value)
                },
                client2: {
                    name: document.getElementById('client2Name').value,
                    lastName: document.getElementById('client2LastName').value,
                    dob: document.getElementById('client2DOB').value || null,
                    age: GlobalStateManager.calculateAge(document.getElementById('client2DOB').value),
                    enabled: !!document.getElementById('client2Name').value
                },
                filingStatus: document.getElementById('filingStatus').value,
                state: document.getElementById('residenceState').value
            };
        }

        // Save all data
        function saveAll() {
            const personalInfo = collectPersonalInfo();
            GlobalStateManager.setState(personalInfo);
            showToast('Profile saved & synced!');
        }

        // Toast notification
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // Export to JSON
        function exportToJSON() {
            const state = GlobalStateManager.getState();
            const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `client-profile-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import from JSON
        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    GlobalStateManager.setState(data);
                    populatePersonalInfo();
                    renderIncomeSources();
                    renderAssets();
                    renderLiabilities();
                    updateSummary();
                    showToast('Profile loaded!');
                } catch (err) {
                    alert('Invalid JSON file');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            populatePersonalInfo();
            renderIncomeSources();
            renderAssets();
            renderLiabilities();
            updateSummary();

            // Re-render lists when client names change (to update owner dropdowns)
            document.getElementById('client1Name').addEventListener('input', function () {
                renderIncomeSources();
                renderAssets();
            });
            document.getElementById('client2Name').addEventListener('input', function () {
                renderIncomeSources();
                renderAssets();
            });
        });
    </script>
</body>

</html>